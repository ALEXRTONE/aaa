<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>IDEX - Datos Históricos</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* (Todo tu estilo original permanece igual) */
    </style>
</head>
<body>
<header id="header">
    <img src="logo.png" alt="IDEX Logo"><h1>Datos que se transforman en poder</h1>
    <button id="btnLogin" onclick="mostrarLogin()">Iniciar Sesión</button>
</header>
<div id="descripcionIDEX">
    <p>IDEX es una plataforma avanzada de visualización de datos históricos que permite a empresas y profesionales acceder a información clave sobre precios y tendencias de commodities...</p>
</div>
<div class="landing" id="landing">
    <div class="card">
        <h2>Plan Básico</h2>
        <p>Acceso a gráficas mensuales.</p>
        <p><strong>$99 MXN / mes</strong></p>
        <button onclick="mostrarLogin()">Acceder</button>
    </div>
    <div class="card">
        <h2>Plan Premium</h2>
        <p>Acceso a gráficas y descargas.</p>
        <p><strong>$199 MXN / mes</strong></p>
        <button onclick="mostrarLogin()">Acceder</button>
    </div>
</div>
<div class="login-container" id="login">
    <div class="login-box">
        <img src="logo.png" alt="IDEX Logo" style="height: 60px; margin-bottom: 20px;">
        <h2>Iniciar sesión</h2>
        <input type="text" id="username" placeholder="Usuario">
        <input type="password" id="password" placeholder="Contraseña">
        <button onclick="validarLogin()">Entrar</button>
        <button onclick="mostrarRegistro()">Crear cuenta</button>
        <p id="error" style="color: red; display: none;">Usuario o contraseña incorrectos</p>
    </div>
</div>
<div class="registro-container" id="registro">
    <div class="registro-box">
        <img src="logo.png" alt="IDEX Logo" style="height: 60px; margin-bottom: 20px;">
        <h2>Crear Cuenta</h2>
        <input type="text" id="newUsername" placeholder="Usuario">
        <input type="email" id="newEmail" placeholder="Correo electrónico">
        <input type="password" id="newPassword" placeholder="Contraseña">
        <button onclick="registrarUsuario()">Registrar</button>
        <button onclick="mostrarLogin()">Volver al login</button>
    </div>
</div>
<div class="container" id="contenido">
    <div class="main">
        <h2>Acceso a datos históricos</h2>
        <label><input type="checkbox" id="todosMeses" checked onchange="toggleTodosMeses(this)"> Todos los meses</label>
        <div class="meses-scroll" id="filtroMes"></div>
        <div id="graficos"></div>
    </div>
    <div class="sidebar">
        <h3>Selecciona los commodities</h3>
        <label><input type="checkbox" id="todosCommodities" checked onchange="toggleTodosCommodities(this)"> Todos los commodities</label>
        <div id="filtroCommodities"></div>
        <button onclick="actualizarGraficos()">Actualizar Gráficas</button>
    </div>
</div>
<script>
// Inicializamos usuarios guardados en localStorage o lista por defecto
let usuarios = JSON.parse(localStorage.getItem('usuarios')) || [{usuario: "admin", contrasena: "1234"}];

function guardarUsuarios() {
    localStorage.setItem('usuarios', JSON.stringify(usuarios));
}

function mostrarLogin() {
    document.getElementById('landing').style.display = 'none';
    document.getElementById('login').style.display = 'flex';
    document.getElementById('registro').style.display = 'none';
    document.getElementById('header').style.display = 'none';
    document.getElementById('contenido').style.display = 'none';
    document.getElementById('descripcionIDEX').style.display = 'none';
}

function mostrarRegistro() {
    document.getElementById('login').style.display = 'none';
    document.getElementById('registro').style.display = 'flex';
}

function validarLogin() {
    const user = document.getElementById('username').value.trim();
    const pass = document.getElementById('password').value.trim();
    const existe = usuarios.some(u => u.usuario === user && u.contrasena === pass);
    if (existe) {
        document.getElementById('login').style.display = "none";
        document.getElementById('contenido').style.display = "flex";
        document.getElementById('header').style.display = "block";
        document.getElementById('descripcionIDEX').style.display = 'none';
        document.getElementById('btnLogin').style.display = 'none';
        inicializarFiltros();
    } else {
        document.getElementById('error').textContent = "Usuario o contraseña incorrectos";
        document.getElementById('error').style.display = "block";
    }
}

function registrarUsuario() {
    const user = document.getElementById('newUsername').value.trim();
    const email = document.getElementById('newEmail').value.trim();
    const pass = document.getElementById('newPassword').value.trim();
    if(user && email && pass) {
        if (usuarios.some(u => u.usuario === user)) {
            alert('El usuario ya existe');
            return;
        }
        usuarios.push({usuario: user, contrasena: pass});
        guardarUsuarios();
        alert('Usuario registrado exitosamente');
        mostrarLogin();
    } else {
        alert('Por favor completa todos los campos');
    }
}

function inicializarFiltros() {
    const meses = ["May 2024","Jun 2024","Jul 2024","Ago 2024","Sep 2024","Oct 2024","Nov 2024","Dic 2024","Ene 2025","Feb 2025","Mar 2025","Abr 2025","May 2025"];
    const filtroMes = document.getElementById('filtroMes');
    filtroMes.innerHTML = '';
    meses.forEach(mes => {
        const label = document.createElement('label');
        const checkbox = document.createElement('input');
        checkbox.type = 'checkbox';
        checkbox.value = mes;
        checkbox.checked = true;
        label.appendChild(checkbox);
        label.appendChild(document.createTextNode(" " + mes));
        filtroMes.appendChild(label);
        filtroMes.appendChild(document.createElement('br'));
    });
    const filtroCom = document.getElementById('filtroCommodities');
    filtroCom.innerHTML = '';
    for (let familia in listaCommodities) {
        const button = document.createElement('button');
        button.className = 'accordion';
        button.textContent = familia;
        filtroCom.appendChild(button);
        const panel = document.createElement('div');
        panel.className = 'panel';
        listaCommodities[familia].forEach(nombre => {
            const label = document.createElement('label');
            const checkbox = document.createElement('input');
            checkbox.type = 'checkbox';
            checkbox.value = nombre;
            checkbox.checked = true;
            label.appendChild(checkbox);
            label.appendChild(document.createTextNode(" " + nombre));
            panel.appendChild(label);
            panel.appendChild(document.createElement('br'));
        });
        filtroCom.appendChild(panel);
    }
    inicializarAcordeones();
    actualizarGraficos();
}
function inicializarAcordeones() {
    const acc = document.getElementsByClassName("accordion");
    for (let i = 0; i < acc.length; i++) {
        acc[i].addEventListener("click", function() {
            this.classList.toggle("active");
            const panel = this.nextElementSibling;
            panel.style.display = (panel.style.display === "block") ? "none" : "block";
        });
    }
}
function toggleTodosMeses(source) {
    const checkboxes = document.querySelectorAll('#filtroMes input[type="checkbox"]');
    checkboxes.forEach(cb => cb.checked = source.checked);
}
function toggleTodosCommodities(source) {
    const checkboxes = document.querySelectorAll('.panel input[type="checkbox"]');
    checkboxes.forEach(cb => cb.checked = source.checked);
}
function actualizarGraficos() {
    const selectedMeses = Array.from(document.querySelectorAll('#filtroMes input:checked')).map(cb => cb.value);
    const selectedCommodities = Array.from(document.querySelectorAll('.panel input:checked')).map(cb => cb.value);
    fetch('datos_commodities.json').then(response => response.json()).then(data => {
        const contenedor = document.getElementById('graficos');
        contenedor.innerHTML = '';
        const meses = ["May 2024","Jun 2024","Jul 2024","Ago 2024","Sep 2024","Oct 2024","Nov 2024","Dic 2024","Ene 2025","Feb 2025","Mar 2025","Abr 2025","May 2025"];
        const mesesSeleccionados = selectedMeses.length === 0 ? meses : selectedMeses;
        Object.entries(data).forEach(([nombre, valores]) => {
            if (!selectedCommodities.includes(nombre)) return;
            const serie = valores['Precio'] || valores['Valor'];
            if (!serie) return;
            const indices = mesesSeleccionados.map(mes => meses.indexOf(mes)).filter(idx => idx !== -1);
            const mesesFiltrados = indices.map(i => meses[i]);
            const valoresFiltrados = indices.map(i => serie[i]);
            const canvas = document.createElement('canvas');
            contenedor.appendChild(canvas);
            const ctx = canvas.getContext('2d');
            new Chart(ctx, { type: 'line', data: { labels: mesesFiltrados, datasets: [{ label: nombre, data: valoresFiltrados, borderColor: '#0071e3', fill: false }] }, options: { responsive: true, scales: { y: { beginAtZero: false } } } });
        });
    }).catch(error => {
        console.error('Error al cargar datos:', error);
    });
}
</script>
</body>
</html>
